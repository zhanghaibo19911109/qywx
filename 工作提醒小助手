name: ä¼ä¸šå¾®ä¿¡æ¯æ—¥æé†’ï¼ˆå«å¤©æ°”ï¼‰
on:
  schedule:
    - cron: '0 1 * * *'  # UTCæ—¶é—´1ç‚¹ï¼ˆåŒ—äº¬æ—¶é—´9ç‚¹ï¼‰

jobs:
  send-message:
    runs-on: ubuntu-latest
    steps:
      - name: è·å–å¤©æ°”å’Œä»»åŠ¡æé†’
        env:
          QWEATHER_KEY: ${{ secrets.QWEATHER_KEY }}  # å’Œé£å¤©æ°”APIå¯†é’¥
          LOCATION: 101260708  # å¨å®å¿åŸå¸‚ä»£ç 
        run: |
          # ---------- ç¬¬ä¸€éƒ¨åˆ†ï¼šè·å–å¤©æ°”æ•°æ® ----------
          weather_data=$(curl -s "https://devapi.qweather.com/v7/weather/now?location=$LOCATION&key=$QWEATHER_KEY")
          temp=$(echo $weather_data | jq -r '.now.temp')
          text=$(echo $weather_data | jq -r '.now.text')
          
          # ---------- ç¬¬äºŒéƒ¨åˆ†ï¼šæ„å»ºMarkdownæ¶ˆæ¯ ----------
          message="## ğŸ“… ä»Šæ—¥ç»¼åˆæé†’\n\n"
          message+="### ğŸŒ¦ å¨å®å¿å¤©æ°”\n"
          message+="- **æ¸©åº¦**: ${temp}â„ƒ\n"
          message+="- **å¤©æ°”**: ${text}\n\n"
          message+="è¯·æ‹ç…§æ‰“å¡è‡³ç›¸å…³ç¾¤\n"
          message+="åŠæ—¶ç‚¹å‡»å·²æ´¾é€æˆ–å·²ç­¾æ”¶\n"
          message+="æ´¾é€å®Œæ¯•å…¨é‡æ”¶å–è¿”è´§\n\n"
          message+="@æ‰€æœ‰äºº"

          # ---------- ç¬¬ä¸‰éƒ¨åˆ†ï¼šå‘é€åˆ°ä¼ä¸šå¾®ä¿¡ ----------
          curl -X POST \
            -H "Content-Type: application/json" \
            -d "{
              \"msgtype\": \"markdown\",
              \"markdown\": {
                \"content\": \"$message\"
              }
            }" \
            "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=6e11c222-b276-49bd-9de9-68d8f207d6e8"
